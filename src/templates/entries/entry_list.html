{% extends "base.html" %}

{% block title %}Lançamentos financeiros{% endblock %}

{% block content %}
  <div
    class="row g-4 align-items-start"
    id="entries-layout"
    data-start-visible="{% if form_visible %}true{% else %}false{% endif %}"
  >
    <div class="col-lg-4{% if not form_visible %} d-none{% endif %}" id="entry-form-column">
      <div class="card shadow-sm">
        <div class="card-header">
          <h5 class="mb-0">
            {% if editing_entry %}
              Editar lançamento
            {% else %}
              Novo lançamento
            {% endif %}
          </h5>
        </div>
        <div class="card-body">
          <div id="entry-form">
            {% include "entries/partials/entry_form.html" %}
          </div>
          <small class="text-muted d-block mt-2">
            Valores positivos representam recebimentos; negativos representam pagamentos.
          </small>
        </div>
      </div>
    </div>
    <div class="col-lg-{% if form_visible %}8{% else %}12{% endif %}" id="entries-column">
      <div id="entries-summary" class="mb-3">
        {% include "entries/partials/entry_summary.html" %}
      </div>
      <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
        <button
          type="button"
          class="btn btn-primary{% if form_visible %} d-none{% endif %}"
          id="toggle-form-btn"
        >
          Novo
        </button>
        <form
          method="get"
          action="{% url 'entries:list' %}"
          class="ms-auto"
        >
          <div class="input-group">
            <input
              type="search"
              name="q"
              class="form-control"
              placeholder="Buscar descrição..."
              value="{{ search_query }}"
            />
            <button class="btn btn-outline-secondary" type="submit">
              Buscar
            </button>
          </div>
        </form>
      </div>
      <div class="card shadow-sm mt-4">
        <div class="card-header">
          <h5 class="mb-0">Lançamentos</h5>
        </div>
        {% include "entries/partials/entry_table.html" %}
      </div>
    </div>
  </div>
{% endblock %}

{% block extra_js %}
  <script>
    (function () {
      const layout = document.getElementById("entries-layout");
      const formColumn = document.getElementById("entry-form-column");
      const entriesColumn = document.getElementById("entries-column");
      const toggleBtn = document.getElementById("toggle-form-btn");
      if (!layout || !formColumn || !entriesColumn || !toggleBtn) {
        return;
      }

      const showForm = () => {
        formColumn.classList.remove("d-none");
        entriesColumn.classList.remove("col-lg-12");
        entriesColumn.classList.add("col-lg-8");
        toggleBtn.classList.add("d-none");
        const firstInput = formColumn.querySelector(
          "input:not([type='hidden']):not([disabled]), select:not([disabled]), textarea:not([disabled])"
        );
        if (firstInput) {
          firstInput.focus();
        }
      };

      const hideForm = () => {
        formColumn.classList.add("d-none");
        entriesColumn.classList.remove("col-lg-8");
        entriesColumn.classList.add("col-lg-12");
        toggleBtn.classList.remove("d-none");
        toggleBtn.textContent = "Novo";
      };

      const startVisible = layout.dataset.startVisible === "true";
      if (!startVisible) {
        hideForm();
      } else {
        showForm();
      }

      toggleBtn.addEventListener("click", showForm);
    })();
  </script>
{% endblock %}
